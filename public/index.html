<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Socket.IO Counter</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    #personal-count {
      -webkit-user-select: none; /* Safari ve eski tarayıcılar */
      -moz-user-select: none;    /* Firefox */
      -ms-user-select: none;     /* Eski IE */
      user-select: none;         /* Modern tarayıcılar */
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-100 to-blue-300 flex items-center justify-center min-h-screen">
  <div class="bg-white shadow-xl rounded-2xl p-8 text-center w-80 relative">
    <h1 class="text-xl font-bold text-gray-800 mb-2">
      إِنَّا لِلّهِ وَإِنَّـا إِلَيْهِ رَاجِعونَ
    </h1>
    <p class="text-sm text-gray-600 mb-6 italic">
      İnna lillâhi ve innâ ileyhi râciûn
    </p>

    <p class="text-lg text-gray-700 font-semibold mb-4">
      Lâ ilâhe illâllah, Muhammedün Rasûlullah
    </p>

    <div class="mb-4">
      <label for="target-input" class="block text-sm text-gray-600 mb-2">Hedef:</label>
      <input
        id="target-input"
        type="number"
        class="w-full border border-gray-300 rounded-lg p-2 text-center bg-gray-100 text-gray-700 focus:outline-none"
        value="70000"
        readonly
      />
    </div>

    <!-- Sayaç Kapsayıcısı -->
    <div class="relative mx-auto w-52 h-52">
      <!-- Büyük Sayaç Çemberi -->
      <div
        id="count-display"
        class="text-4xl font-extrabold text-green-600 bg-green-100 rounded-full w-52 h-52 flex items-center justify-center mx-auto cursor-pointer hover:bg-green-200 transition duration-200 outline-none focus:outline-none focus:ring-0 select-none touch-action-manipulation"
        tabindex="-1"
      >
        0
      </div>

      <!-- Kişisel Katkı (Tıklamaya Kapalı, Sağ Üstte) -->
      <div id="personal-count" class="absolute -top-3 -right-3 w-8 h-8 bg-green-500 text-white text-sm font-bold rounded-full flex items-center justify-center shadow-lg pointer-events-none focus:outline-none select-none">
        0
      </div>
    </div>

    <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden mt-4">
      <div id="progress-bar" class="bg-blue-500 h-4 rounded-full" style="width: 0%;"></div>
    </div>

    <p id="progress-text" class="text-sm text-gray-600 mt-2">0%</p>

    <!-- Online Kullanıcı Sayısı (Daha Estetik) -->
    <div class="flex items-center justify-center mt-4">
      <span class="bg-green-500 text-white text-sm font-semibold px-4 py-2 rounded-full shadow-md">
        🟢 Online: <span id="online-count">0</span>
      </span>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    let userId = localStorage.getItem("userId");
    if (!userId) {
      userId = Math.random().toString(36).substring(2);
      localStorage.setItem("userId", userId);
    }

    socket.emit("registerUser", userId);

    socket.on("connect", () => {
      console.log("Connected to server");
    });

    // 📌 Tarayıcıdaki en son verileri yükle (0 yerine güncel veri göster)
    document.getElementById("count-display").textContent = localStorage.getItem("lastCount") || 0;
    document.getElementById("personal-count").textContent = localStorage.getItem("lastPersonalCount") || 0;

    // 🔄 Sunucudan güncel sayaç verilerini alıp ekrana anında yansıt
    socket.on("updateCount", (count) => {
      document.getElementById("count-display").textContent = count;
      updateProgressBar(count);
      localStorage.setItem("lastCount", count); // Yeni değeri tarayıcıda sakla
    });

    socket.on("personalCount", (personalCount) => {
      document.getElementById("personal-count").textContent = personalCount;
      localStorage.setItem("lastPersonalCount", personalCount); // Kişisel sayıyı sakla
    });

    socket.on("onlineCount", (count) => {
      document.getElementById("online-count").textContent = count;
    });

    document.getElementById("count-display").addEventListener("click", () => {
      socket.emit("increment", userId);
    });

    function updateProgressBar(count) {
      const target = 70000;
      const percentage = (count / target) * 100;
      document.getElementById("progress-bar").style.width = `${percentage}%`;
      document.getElementById("progress-text").textContent = `${percentage.toFixed(2)}%`;
    }

    // ✅ Çift tıklayarak zoom yapılmasını engelle
    document.addEventListener("dblclick", (e) => {
      e.preventDefault();
    }, { passive: false });

    // ✅ İki parmakla zoom yapmayı engelle
    document.addEventListener("gesturestart", (e) => {
      e.preventDefault();
    }, { passive: false });

  </script>
</body>
</html>